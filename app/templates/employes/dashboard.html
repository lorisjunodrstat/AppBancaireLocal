{% extends "base.html" %}

{% block head_css %}
<style>
    .dashboard-alerts {
        margin: 1.5rem 0;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .dashboard-alerts .alert {
        padding: 1rem;
        border-radius: 8px;
    }

    .dashboard-actions {
        margin: 2rem 0;
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }
</style>
{% endblock %}

{% block title %}Dashboard Employ√©s{% endblock %}

{% block content %}
<h2>Dashboard Employ√©s</h2>

<!-- === CARTES D'ALERTE === -->
<div class="dashboard-alerts">
    {% if not types_cotisation %}
    <div class="alert alert-warning">
        <strong>‚ö†Ô∏è Aucune cotisation d√©finie</strong><br>
        Commencez par d√©finir vos types de cotisations (ex: AVS, LPP, AC‚Ä¶).
        <br>
        <a href="{{ url_for('banking.liste_types_cotisation') }}" class="btn btn-sm btn-primary">
            Configurer les cotisations
        </a>
    </div>
    {% endif %}

    {% if not types_indemnite %}
    <div class="alert alert-warning">
        <strong>‚ö†Ô∏è Aucune indemnit√© d√©finie</strong><br>
        D√©finissez vos types d'indemnit√©s (ex: repas, vacances, jours f√©ri√©s‚Ä¶).
        <br>
        <a href="{{ url_for('banking.liste_types_indemnite') }}" class="btn btn-sm btn-primary">
            Configurer les indemnit√©s
        </a>
    </div>
    {% endif %}

    {% if not contrats %}
    <div class="alert alert-info">
        <strong>üìù Aucun contrat cr√©√©</strong><br>
        Cr√©ez un premier contrat pour un employ√© pour pouvoir saisir des heures et g√©n√©rer des salaires.
        <br>
        {% if employes %}
        <a href="{{ url_for('banking.creer_contrat_employe', employe_id=employes[0].id) }}"
            class="btn btn-sm btn-success">
            Cr√©er un contrat
        </a>
        {% else %}
        <em>(Cr√©ez d'abord un employ√©)</em>
        {% endif %}
    </div>
    {% endif %}

    {% if not employes %}
    <div class="alert alert-info">
        <strong>üë§ Aucun employ√© enregistr√©</strong><br>
        Ajoutez votre premier employ√© pour commencer la gestion RH.
        <br>
        <a href="{{ url_for('banking.create_employe') }}" class="btn btn-sm btn-success">
            Ajouter un employ√©
        </a>
    </div>
    {% endif %}
</div>

<!-- === R√âSUM√â MENSUEL === -->
{% if employes %}
<p>Nombre total d'employ√©s : {{ all_employes }}</p>
<p>Mois : {{ mois }} / {{ annee }}</p>
<p>Heures totales : {{ "%.2f"|format(heures_total_mois) }} h</p>
<p>Salaire total : {{ "%.2f"|format(salaire_total_mois) }} CHF</p>

<!-- CORRECTION : changer les noms des champs -->
<form method="get" style="margin: 1rem 0;">
    <label>Mois :
        <select name="mois"> <!-- ‚Üê CORRECTION : "mois" pas "date_dashboard_mois" -->
            {% for m in range(1,13) %}
            <option value="{{ m }}" {% if m==mois %}selected{% endif %}>{{ m }}</option>
            {% endfor %}
        </select>
    </label>
    <label>Ann√©e :
        <input type="number" name="annee" value="{{ annee }}" min="2020" max="2030">
        <!-- ‚Üê CORRECTION : "annee" pas "date_dashboard_annee" -->
    </label>
    <button type="submit" class="btn btn-secondary">Actualiser</button>
</form>
{% endif %}

<!-- === ACTIONS RAPIDES === -->
<div class="dashboard-actions">
    {% if employes %}
    <a href="{{ url_for('banking.planning_employes') }}" class="btn btn-outline-secondary">üìä Planning global</a>
    <a href="{{ url_for('banking.synthese_mensuelle') }}" class="btn btn-outline-secondary">üìà Synth√®se mensuelle</a>
    {% endif %}
    <a href="{{ url_for('banking.liste_employe') }}" class="btn btn-outline-primary">üë• Liste des employ√©s</a>
    <a href="{{ url_for('banking.gestion_entreprise') }}" class="btn btn-outline-primary">üè¢ Informations entreprise</a>
</div>

<!-- === LISTE DES EMPLOY√âS === -->
{% if employes %}
<h3>Liste des employ√©s</h3>
<ul>
    {% for e in employes %}
    <li>
        <a href="{{ url_for('banking.detail_employe', employe_id=e.id) }}">
            {{ e.prenom }} {{ e.nom }}
        </a>
        {% if e.id_contrat %}
        <small>(contrat #{{ e.id_contrat }})</small>
        {% endif %}
    </li>
    {% endfor %}
</ul>
{% endif %}

{% endblock %}