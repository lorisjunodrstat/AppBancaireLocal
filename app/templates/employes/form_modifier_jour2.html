{% extends "base.html" %}

{% block title %}Modifier le planning - {{ date_display }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Modifier le planning</h2>
    
    <div class="card">
        <div class="card-header">
            <h4>{{ date_display }} - {{ employe.prenom }} {{ employe.nom }}</h4>
            <p class="mb-0">Total heures: <strong>{{ "%.1f"|format(total_heures) }}h</strong></p>
        </div>
        
        <div class="card-body">
            <!-- Affichage des shifts existants -->
            {% if shifts %}
            <div class="mb-4">
                <h5>Shifts existants :</h5>
                <div class="list-group">
                    {% for shift in shifts %}
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ shift.heure_debut|default('') }} - {{ shift.heure_fin|default('') }}</strong>
                                <span class="badge bg-secondary ms-2">{{ shift.type_shift|default('travail') }}</span>
                                {% if shift.commentaire %}
                                <p class="mb-0 mt-1"><small>{{ shift.commentaire }}</small></p>
                                {% endif %}
                            </div>
                            <div>
                                <span class="badge bg-primary">{{ "%.1f"|format(shift.duree|default(0)) }}h</span>
                                <!-- Bouton supprimer shift -->
                                <form method="post" action="{{ url_for('banking.planning_supprimer_shift') }}" 
                                      class="d-inline ms-2">
                                    <input type="hidden" name="shift_id" value="{{ shift.id }}">
                                    <input type="hidden" name="date" value="{{ date }}">
                                    <input type="hidden" name="employe_id" value="{{ employe_id }}">
                                    <input type="hidden" name="employeur" value="{{ employeur }}">
                                    <input type="hidden" name="id_contrat" value="{{ id_contrat }}">
                                    <input type="hidden" name="annee" value="{{ annee }}">
                                    <input type="hidden" name="mois" value="{{ mois }}">
                                    <input type="hidden" name="semaine" value="{{ semaine }}">
                                    <input type="hidden" name="mode" value="{{ mode }}">
                                    <button type="submit" class="btn btn-sm btn-danger"
                                            onclick="return confirm('Supprimer ce shift ?')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- Formulaire pour ajouter un nouveau shift -->
            <h5>Ajouter un nouveau shift :</h5>
            <form method="post" action="{{ url_for('banking.planning_ajouter_shift') }}">
                <input type="hidden" name="date" value="{{ date }}">
                <input type="hidden" name="employe_id" value="{{ employe_id }}">
                <input type="hidden" name="employeur" value="{{ employeur }}">
                <input type="hidden" name="id_contrat" value="{{ id_contrat }}">
                <input type="hidden" name="annee" value="{{ annee }}">
                <input type="hidden" name="mois" value="{{ mois }}">
                <input type="hidden" name="semaine" value="{{ semaine }}">
                <input type="hidden" name="mode" value="{{ mode }}">
                
                <div class="row g-3">
                    <div class="col-md-3">
                        <label for="heure_debut" class="form-label">Heure d√©but :</label>
                        <input type="time" class="form-control" id="heure_debut" name="heure_debut" 
                               required step="300">
                    </div>
                    
                    <div class="col-md-3">
                        <label for="heure_fin" class="form-label">Heure fin :</label>
                        <input type="time" class="form-control" id="heure_fin" name="heure_fin" 
                               required step="300">
                    </div>
                    
                    <div class="col-md-3">
                        <label for="type_shift" class="form-label">Type :</label>
                        <select class="form-select" id="type_shift" name="type_shift">
                            {% for type in types_shifts %}
                            <option value="{{ type }}">{{ type|capitalize }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3">
                        <label for="commentaire" class="form-label">Commentaire :</label>
                        <input type="text" class="form-control" id="commentaire" name="commentaire">
                    </div>
                </div>
                
                <div class="mt-3">
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-plus-circle"></i> Ajouter le shift
                    </button>
                </div>
            </form>
            
            <!-- Bouton retour -->
            <hr>
            <div class="d-flex justify-content-between">
                <a href="{{ url_for('banking.planning_employes',
                           annee=annee,
                           mois=mois,
                           semaine=semaine,
                           mode=mode,
                           employeur=employeur,
                           id_contrat=id_contrat) }}" 
                   class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Retour au planning
                </a>
                
                <button type="button" class="btn btn-info" onclick="window.print()">
                    <i class="bi bi-printer"></i> Imprimer
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}