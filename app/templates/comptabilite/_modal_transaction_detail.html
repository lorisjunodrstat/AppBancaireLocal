<!-- Modal pour les dÃ©tails de transaction -->
<div class="modal fade show" id="transactionModal" tabindex="-1" aria-labelledby="transactionModalLabel"
    aria-hidden="false" style="display: block; background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="transactionModalLabel">
                    DÃ©tails de la transaction #{{ transaction_detail.id }}
                </h5>
                <!-- Bouton fermer avec lien direct -->
                {% if request.endpoint == 'banking.liste_ecritures_par_contact' %}
                <a href="{{ url_for('banking.liste_ecritures_par_contact',
                                          contact_id=contact.id_contact,
                                          compte_id=request.args.get('compte_id'),
                                          date_from=request.args.get('date_from'),
                                          date_to=request.args.get('date_to'),
                                          id_contact=request.args.get('id_contact'),
                                          statut=request.args.get('statut'),
                                          categorie_id=request.args.get('categorie_id')) }}"
                    class="btn-close btn-close-white" aria-label="Fermer">
                </a>
                {% else %}
                <a href="{{ url_for('banking.liste_ecritures',
                                          compte_id=request.args.get('compte_id'),
                                          date_from=request.args.get('date_from'),
                                          date_to=request.args.get('date_to'),
                                          id_contact=request.args.get('id_contact'),
                                          statut=request.args.get('statut'),
                                          categorie_id=request.args.get('categorie_id')) }}"
                    class="btn-close btn-close-white" aria-label="Fermer">
                </a>
                {% endif %}
            </div>
            <div class="modal-body">
                <ul class="list-unstyled">
                    <li><strong>Date :</strong> {{ transaction_detail.date_transaction.strftime('%d.%m.%Y') if
                        transaction_detail.date_transaction else 'â€”' }}</li>
                    <li><strong>Montant :</strong> {{ "%.2f"|format(transaction_detail.montant) }} CHF</li>
                    <li><strong>Type :</strong> {{ transaction_detail.type_transaction or 'â€”' }}</li>
                    <li><strong>Description :</strong> {{ transaction_detail.description or 'â€”' }}</li>
                    <li><strong>RÃ©fÃ©rence :</strong> {{ transaction_detail.reference or 'â€”' }}</li>

                    <!-- Compte principal -->
                    <li><strong>Compte principal :</strong>
                        {{ transaction_detail.compte_principal_nom or 'â€”' }}
                        {% if transaction_detail.compte_principal_banque %}
                        ({{ transaction_detail.compte_principal_banque }})
                        {% endif %}
                    </li>

                    <!-- Compte destination (si transfert) -->
                    {% if transaction_detail.compte_destination_nom %}
                    <li><strong>Compte destinataire :</strong>
                        {{ transaction_detail.compte_destination_nom }}
                        {% if transaction_detail.compte_destination_banque %}
                        ({{ transaction_detail.compte_destination_banque }})
                        {% endif %}
                    </li>
                    {% endif %}

                    <!-- Compte source (si applicable) -->
                    {% if transaction_detail.compte_source_nom %}
                    <li><strong>Compte source :</strong>
                        {{ transaction_detail.compte_source_nom }}
                        {% if transaction_detail.compte_source_banque %}
                        ({{ transaction_detail.compte_source_banque }})
                        {% endif %}
                    </li>
                    {% endif %}

                    <!-- Solde aprÃ¨s (optionnel) -->
                    <li><strong>Solde aprÃ¨s :</strong> {{ "%.2f"|format(transaction_detail.solde_apres) }} CHF</li>
                </ul>
            </div>
            <div class="modal-footer">
                <!-- ðŸ”¥ CORRECTION : Ajouter la mÃªme logique conditionnelle ici -->
                {% if request.endpoint == 'banking.liste_ecritures_par_contact' %}
                <a href="{{ url_for('banking.liste_ecritures_par_contact',
                                          contact_id=contact.id_contact,
                                          compte_id=request.args.get('compte_id'),
                                          date_from=request.args.get('date_from'),
                                          date_to=request.args.get('date_to'),
                                          id_contact=request.args.get('id_contact'),
                                          statut=request.args.get('statut'),
                                          categorie_id=request.args.get('categorie_id')) }}" class="btn btn-secondary">
                    Fermer
                </a>
                {% else %}
                <a href="{{ url_for('banking.liste_ecritures',
                                          compte_id=request.args.get('compte_id'),
                                          date_from=request.args.get('date_from'),
                                          date_to=request.args.get('date_to'),
                                          id_contact=request.args.get('id_contact'),
                                          statut=request.args.get('statut'),
                                          categorie_id=request.args.get('categorie_id')) }}" class="btn btn-secondary">
                    Fermer
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>